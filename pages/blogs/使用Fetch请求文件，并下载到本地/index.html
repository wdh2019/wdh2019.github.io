<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Fetch请求文件，并下载到本地 | wdh2019的学习空间</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="欢迎来到wdh2019的学习空间">
    
    <link rel="preload" href="/assets/css/0.styles.1e8ff529.css" as="style"><link rel="preload" href="/assets/js/app.a80134b2.js" as="script"><link rel="preload" href="/assets/js/2.0ddda4ce.js" as="script"><link rel="preload" href="/assets/js/6.e9b0de4e.js" as="script"><link rel="prefetch" href="/assets/js/10.6cefd4ee.js"><link rel="prefetch" href="/assets/js/11.d2b6fa84.js"><link rel="prefetch" href="/assets/js/12.c50f5074.js"><link rel="prefetch" href="/assets/js/13.55ef50f4.js"><link rel="prefetch" href="/assets/js/14.47936b94.js"><link rel="prefetch" href="/assets/js/15.e0be5ff0.js"><link rel="prefetch" href="/assets/js/16.852ab146.js"><link rel="prefetch" href="/assets/js/17.9ba5bade.js"><link rel="prefetch" href="/assets/js/18.259718da.js"><link rel="prefetch" href="/assets/js/19.6f1127e8.js"><link rel="prefetch" href="/assets/js/20.aec2bca0.js"><link rel="prefetch" href="/assets/js/21.4d3c1b9b.js"><link rel="prefetch" href="/assets/js/22.509438de.js"><link rel="prefetch" href="/assets/js/23.5018fb14.js"><link rel="prefetch" href="/assets/js/24.201f4969.js"><link rel="prefetch" href="/assets/js/25.3dd15286.js"><link rel="prefetch" href="/assets/js/26.1074bdc3.js"><link rel="prefetch" href="/assets/js/3.60c22acf.js"><link rel="prefetch" href="/assets/js/4.eca2b075.js"><link rel="prefetch" href="/assets/js/5.09ae4475.js"><link rel="prefetch" href="/assets/js/7.f90aec6d.js"><link rel="prefetch" href="/assets/js/8.19f78893.js"><link rel="prefetch" href="/assets/js/9.89a4b848.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1e8ff529.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wdh2019的学习空间</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/" class="nav-link">博客</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/" class="nav-link">博客</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>博客</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/blogs/第一篇博客/" class="sidebar-link">第一篇博客</a></li><li><a href="/pages/blogs/Vue2响应式/" class="sidebar-link">Vue2响应式</a></li><li><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/" aria-current="page" class="active sidebar-link">使用Fetch请求文件，并下载到本地</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#问题描述" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header level2"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#问题拆解" class="sidebar-link">问题拆解</a></li><li class="sidebar-sub-header level2"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#解决方案" class="sidebar-link">解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#part-1-使用fetch方法-向后端请求文件" class="sidebar-link">Part 1：使用Fetch方法，向后端请求文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#part-2-将文件下载到本地" class="sidebar-link">Part 2：将文件下载到本地</a></li><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#part-3-完整流程" class="sidebar-link">Part 3：完整流程</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#_2021-8-9-更新" class="sidebar-link">2021/8/9  更新</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#url中的中文" class="sidebar-link">url中的中文</a></li><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#fetch-函数的两次请求" class="sidebar-link">Fetch 函数的两次请求</a></li><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#错误处理" class="sidebar-link">错误处理</a></li><li class="sidebar-sub-header level3"><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/#修改后的演示代码" class="sidebar-link">修改后的演示代码</a></li></ul></li></ul></li><li><a href="/pages/blogs/Vue-vs-React/" class="sidebar-link">Vue vs React</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=blogs" title="分类" data-v-06225672>blogs</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">使用Fetch请求文件，并下载到本地<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="使用fetch请求文件-并下载到本地"><a href="#使用fetch请求文件-并下载到本地" class="header-anchor">#</a> 使用Fetch请求文件，并下载到本地</h1> <h2 id="问题描述"><a href="#问题描述" class="header-anchor">#</a> 问题描述</h2> <p>最近遇到需要向后端请求文件，并让用户下载到本地的需求。我第一时间想到的是原生的Fetch API，正好可以测试一下如何实际使用Fetch方法请求文件。</p> <p>然而，当我一通搜索+复制黏贴以后，自信地告诉后端同学：“只需要给我一个能请求到文件的url和文件名”之后，后端同学一句“这些具体是指什么”，把我问蒙了。</p> <p>因此，我想着搭建一个简易的前后端传输文件的场景，来测试一下如何利用Fetch方法解决上述的需求。</p> <h2 id="问题拆解"><a href="#问题拆解" class="header-anchor">#</a> 问题拆解</h2> <ol><li>前端如何使用Fetch方法，向后端请求文件。</li> <li>前端如何将请求到的文件下载到用户本地。</li></ol> <h2 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h2> <h3 id="part-1-使用fetch方法-向后端请求文件"><a href="#part-1-使用fetch方法-向后端请求文件" class="header-anchor">#</a> Part 1：使用Fetch方法，向后端请求文件</h3> <h4 id="前端"><a href="#前端" class="header-anchor">#</a> 前端</h4> <p>关于Fetch方法的使用，可以参考笔记中JS一章的对应内容。</p> <p>大致代码：<code>fetch(url).then(res =&gt; res.blob()).then(blob =&gt; {})</code></p> <p>这里我使用了请求二进制大文件的对应方法<code>res.blob()</code>。</p> <p>特别注意的是：<code>url</code>即后端同学问我的可以请求到文件的<code>url</code>，随后可以看到我在简易的后端里是如何处理这个<code>url</code>的。</p> <h4 id="后端"><a href="#后端" class="header-anchor">#</a> 后端</h4> <p>我使用nodejs搭建了一个简易的后端，代码如下：</p> <p>index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span> <span class="token comment">// 解析url</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span>
    
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 读取文件，文件名从pathname.substr(1)解析得到</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span><span class="token string">'http://127.0.0.1:5500'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//成功读取文件，加上Mime类型响应头和跨域响应头</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束响应</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:3000'</span><span class="token punctuation">)</span>
</code></pre></div><p>服务器目录如下：</p> <p><img src="data:image/png;base64,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" alt="fetch-server"></p> <p>需要注意以下几点：</p> <ul><li>我使用了<code>url.parse(req.url).pathname</code>获取了请求的<code>url</code>的路径名。</li> <li>我使用了<code>fs.readFile()</code>根据处理后的路径名读取服务器上对应的文件。<strong>因为index.js和请求的文件是同一级目录，所以读取文件的路径直接写成了文件名。如果要请求的文件不在同一级目录，要修改读取文件的路径。</strong></li> <li>在文件读取成功的逻辑分支里，为了解决<u><strong>跨域问题</strong></u>，我在响应头里写入了<code>Access-Control-Allow-Origin</code>这一头部，并指定其值为前端所在的域名。</li> <li>最后，我通过<code>res.end()</code>将读取的文件数据流作为响应内容，并结束响应。</li></ul> <p>整个后端的处理逻辑：解析<code>url</code>-&gt;读取文件-&gt;设置解决跨域问题的响应头-&gt;返回文件数据</p> <h3 id="part-2-将文件下载到本地"><a href="#part-2-将文件下载到本地" class="header-anchor">#</a> Part 2：将文件下载到本地</h3> <p>前端请求到文件数据以后，还要进行一步处理，使其可以将文件下载到本地。</p> <p>这里我使用了<code>a</code>标签，设置其<code>download</code>属性，来进行下载。其他方案可以自行百度。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">'file1.md'</span> <span class="token comment">// filename</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> url
    a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中注释为<code>filename</code>的地方，上例为<code>file1.md</code>，其实只是指定了用户下载到本地的文件名，可以和服务器上的文件名不一样，相当于重命名了该文件。</p> <h3 id="part-3-完整流程"><a href="#part-3-完整流程" class="header-anchor">#</a> Part 3：完整流程</h3> <p>最后，附上全部代码和整体流程：</p> <h4 id="前端-2"><a href="#前端-2" class="header-anchor">#</a> 前端</h4> <p>index.html</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Fetch <span class="token constant">API</span> test<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>点击下载文件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:3000/file.md&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
                <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
                a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">'file1.md'</span>
                a<span class="token punctuation">.</span>href <span class="token operator">=</span> url
                a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h4 id="后端-2"><a href="#后端-2" class="header-anchor">#</a> 后端</h4> <p>index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span>
    
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string">'Access-Control-Allow-Origin'</span><span class="token operator">:</span><span class="token string">'http://127.0.0.1:5500'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:3000'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="流程"><a href="#流程" class="header-anchor">#</a> 流程</h4> <ol><li><p>将前端index.html页面通过VSCode的live server插件架设到<code>http://127.0.0.1:5500</code></p> <p><img src="/assets/img/fetch-frontend-page.cfced9a7.png" alt="fetch-frontend-page"></p></li> <li><p>点击页面上的按钮，触发点击事件处理程序。在处理程序中，调用了Fetch方法向后端请求文件<code>file.md</code>，其中<code>url</code>为<code>http://127.0.0.1:3000/file.md</code>。</p></li> <li><p>后端接收到请求，解析<code>url</code>，获取到<code>pathname</code>变量为<code>/file.md</code>。</p> <p><img src="data:image/png;base64,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" alt="fetch-server-console"></p> <ul><li>如图看到<code>pathname</code>变量为<code>/file.md</code>，应该对其进行处理才能获取对应的文件名。</li></ul></li> <li><p>后端对<code>pathname</code>变量字符串进行切割，留下对应的文件名<code>file.md</code>，并读取文件。（注意该文件在服务器的目录结构）</p></li> <li><p>后端在响应体中返回文件数据。</p></li> <li><p>前端接收到文件数据，通过创建<code>a</code>标签的方法，将文件下载到本地。（下载到本地的文件名可以被重命名）</p> <p><img src="data:image/png;base64,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" alt="fetch-frontend-downloadedFile"></p></li></ol> <p>因为我测试了很多遍，所以下载的文件名后跟了(3)，但是不影响我们验证了文件确实按照<code>filename</code>进行了重命名。</p> <p>如有错误，欢迎指正！</p> <h2 id="_2021-8-9-更新"><a href="#_2021-8-9-更新" class="header-anchor">#</a> 2021/8/9  更新</h2> <p>在后续的debug中，我发现了上述代码实现的几个问题。这几个问题虽然看起来并没有影响代码功能，实际上只是恰好没有掉入这些坑，或者问题没有表现出来。</p> <h3 id="url中的中文"><a href="#url中的中文" class="header-anchor">#</a> url中的中文</h3> <p>请求的文件url中一旦有中文，就可能会出现意想不到的错误，比如服务端接收到的请求url是<strong>乱码</strong>的。</p> <p>这里可以用一对对应的函数 <code>encodeURI()</code> 和 <code>decodeURI()</code>来对中文进行编码和翻译。</p> <ul><li>在前端，用<code>encodeURI()</code>对中文进行编码：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;GEELY 6AT 项目驻车换挡熄火问题调查_EAV4_孙柱.docx&quot;</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:3000/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token comment">// 用encodeURI()编码url中的中文</span>
	headers<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token string">'content-type'</span><span class="token operator">:</span><span class="token string">'application/json;charset=utf-8'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>编码出来是这样的结果：</p> <div class="language-json extra-class"><pre class="language-json"><code>GEELY%206AT%<span class="token number">20</span>%E9%A1%B9%E7%9B%AE%E9%A9%BB%E8%BD%A6%E6%8D%A2%E6%8C%A1%E7%<span class="token number">86</span>%<span class="token number">84</span>%E7%<span class="token number">81</span>%AB%E9%<span class="token number">97</span>%AE%E9%A2%<span class="token number">98</span>%E8%B0%<span class="token number">83</span>%E6%9F%A5_EAV4_%E5%AD%<span class="token number">99</span>%E6%9F%B1.docx
</code></pre></div><ul><li>在后端，以nodejs举例，可以用<code>decodeURI()</code>对编码后的url进行翻译：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>翻译出来的结果：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GEELY 6AT 项目驻车换挡熄火问题调查_EAV4_孙柱.docx
</code></pre></div><p><strong>注意</strong>：用其他语言可能对应的函数名不同，不一定叫<code>decodeURI</code></p> <h3 id="fetch-函数的两次请求"><a href="#fetch-函数的两次请求" class="header-anchor">#</a> Fetch 函数的两次请求</h3> <p>Fetch 函数在发送非简单请求时，会先进行一次【预检请求】（请求方法为OPTION），目的是为了验证服务器是否可以处理非简单请求。</p> <p>预检请求被通过以后，才会再进行【真正的GET/POST等请求】，<strong>真正去服务器请求资源</strong>。</p> <p>这类似于如下的场景：</p> <p>浏览器（发送OPTION请求）：我的请求可不简单，服务器你这能处理吗？</p> <p>服务器（收到OPTION请求）：我能行（返回200）。</p> <p>浏览器（收到响应码200，再发送GET/POST...请求）：那我这次真的来请求资源啦。</p> <p>服务器（收到GET/POST...请求）：好的，给你（200）/ 抱歉，我没有（404）。</p> <p>至于什么样的请求是【简单请求】，详情自行百度。</p> <p>在本例中，虽然使用的请求方法 GET 是简单请求方法。但是我们还设置了头部 Content-type，其值为 application/json，这一点使得该请求不再属于【简单请求】。</p> <ul><li>对于【简单请求】，fetch 只会发送一次请求。</li> <li>对于跨域且【非简单请求】，fetch 才会发送两次请求。</li></ul> <p><strong>后端再处理请求时，务必要注意对两次不同请求的不同处理！</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 处理第二次的请求方法为GET的请求</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// decodeURI()将url中用encodeURI()编码过的中文进行翻译</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 如果是GET以外的请求，返回200。此处是为了 直接通过 第一次的请求方法为OPTION的请求。</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h3> <p>如果后端因找不到请求的文件而返回404，之前的代码就可能直接把整个响应作为文件的二进制数据，生成一个文件，从而导致非预期的结果。</p> <p>（用户：我的文件怎么只有两行内容，一行是&quot;code&quot;，一行是&quot;message&quot;:&quot;404 Not Found ...&quot; ？？？）</p> <p>因此我们在前端的代码中添加错误处理代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:3000/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token comment">// 用encodeURI()编码url中的中文</span>
	headers<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token string">'content-type'</span><span class="token operator">:</span><span class="token string">'application/json;charset=utf-8'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// res为第一次请求方法为OPTION的请求的响应，用于确认服务器是否具有响应功能</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 若第一次请求通过，则再发送GET请求去请求文件</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 错误处理</span>
		<span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
		err<span class="token punctuation">.</span>response <span class="token operator">=</span> res
		<span class="token keyword">throw</span> err
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 对GET请求的响应数据进行处理，实现用户本地下载文件</span>
	<span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
	<span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
	a<span class="token punctuation">.</span>download <span class="token operator">=</span> filename
	a<span class="token punctuation">.</span>href <span class="token operator">=</span> url
	a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 错误处理</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>另外一小点需要注意的是：</p> <ul><li>使用<code>res.blob()</code>会把响应的数据直接转换成二进制数据，所以直接填到生成的文件中（因为数据表示的本质就是二进制，所以响应的数据无论是什么牛鬼蛇神，都能转）</li> <li>使用<code>res.json()</code>，响应的数据会以json格式返回，所以如果不用<code>JSON.parse()</code>方法先解析json格式数据，就没办法填到生成的文件中（会报错）。</li></ul> <p>第二种方法便于调试，因为这样可以检测出之前代码的问题。（响应体可不是json格式的数据，会报错哦）</p> <p>但为了最少地修改代码（懒），所以修改后的演示代码保持第一种。</p> <h3 id="修改后的演示代码"><a href="#修改后的演示代码" class="header-anchor">#</a> 修改后的演示代码</h3> <p>前端 index.html</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Fetch <span class="token constant">API</span> test<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>点击下载文件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;GEELY 6AT 项目驻车换挡熄火问题调查_EAV4_孙柱.docx&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> filename <span class="token operator">=</span> <span class="token string">&quot;file1.docx&quot;</span><span class="token punctuation">;</span>
            <span class="token function">Fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">Fetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用encodeURI()编码url中的中文</span>

            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:3000/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token comment">// 用encodeURI()编码url中的中文</span>
                headers<span class="token operator">:</span><span class="token punctuation">{</span>
                    <span class="token string">'content-type'</span><span class="token operator">:</span><span class="token string">'application/json;charset=utf-8'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// res为第一次请求方法为OPTION的请求的响应，用于确认服务器是否具有响应功能</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 若第一次请求通过，则再发送GET请求去请求文件</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 错误处理</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span>
                    err<span class="token punctuation">.</span>response <span class="token operator">=</span> res
                    <span class="token keyword">throw</span> err
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 对GET请求的响应数据进行处理，实现用户本地下载文件</span>
                    <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
                    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
                    a<span class="token punctuation">.</span>download <span class="token operator">=</span> filename
                    a<span class="token punctuation">.</span>href <span class="token operator">=</span> url
                    a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">// 错误处理</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>后端 index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// decodeURI()将url中用encodeURI()编码过的中文进行翻译</span>
    
    <span class="token comment">// 为所有响应设置跨域头部</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content-type,XXX&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 处理第二次的请求方法为GET的请求</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token function">decodeURI</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// decodeURI()将url中用encodeURI()编码过的中文进行翻译</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 如果是GET以外的请求，返回200。此处是为了 直接通过 第一次的请求方法为OPTION的请求。</span>
        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:3000'</span><span class="token punctuation">)</span>
</code></pre></div><p>（<strong>我对每个请求做了统一的跨域头部设置，因为两次请求都是跨域的</strong>）</p> <h4 id="前端页面效果"><a href="#前端页面效果" class="header-anchor">#</a> 前端页面效果</h4> <p><img src="/assets/img/fetch-new-frontend-page.5dd824c0.png" alt="fetch-new-frontend-page"></p> <h4 id="后端命令行输出"><a href="#后端命令行输出" class="header-anchor">#</a> 后端命令行输出</h4> <p><img src="/assets/img/fetch-new-server-console.e703a9f1.png" alt="fetch-new-server-console"></p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=fetch" title="标签">#fetch</a><a href="/tags/?tag=Fetch" title="标签">#Fetch</a><a href="/tags/?tag=%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6" title="标签">#请求文件</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/blogs/Vue2响应式/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Vue2响应式</div></a> <a href="/pages/blogs/Vue-vs-React/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Vue vs React</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/blogs/Vue2响应式/" class="prev">Vue2响应式</a></span> <span class="next"><a href="/pages/blogs/Vue-vs-React/">Vue vs React</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/blogs/Vue-vs-React/"><div>
            Vue vs React
            <!----></div></a> <span class="date">07-01</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/blogs/Vue2响应式/"><div>
            Vue2响应式
            <!----></div></a> <span class="date">07-01</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/notes/sorting/"><div>
            排序算法总集篇
            <!----></div></a> <span class="date">07-01</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a80134b2.js" defer></script><script src="/assets/js/2.0ddda4ce.js" defer></script><script src="/assets/js/6.e9b0de4e.js" defer></script>
  </body>
</html>
