<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue | wdh2019的学习空间</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="欢迎来到wdh2019的学习空间">
    
    <link rel="preload" href="/assets/css/0.styles.1e8ff529.css" as="style"><link rel="preload" href="/assets/js/app.a80134b2.js" as="script"><link rel="preload" href="/assets/js/2.0ddda4ce.js" as="script"><link rel="preload" href="/assets/js/5.09ae4475.js" as="script"><link rel="prefetch" href="/assets/js/10.6cefd4ee.js"><link rel="prefetch" href="/assets/js/11.d2b6fa84.js"><link rel="prefetch" href="/assets/js/12.c50f5074.js"><link rel="prefetch" href="/assets/js/13.55ef50f4.js"><link rel="prefetch" href="/assets/js/14.47936b94.js"><link rel="prefetch" href="/assets/js/15.e0be5ff0.js"><link rel="prefetch" href="/assets/js/16.852ab146.js"><link rel="prefetch" href="/assets/js/17.9ba5bade.js"><link rel="prefetch" href="/assets/js/18.259718da.js"><link rel="prefetch" href="/assets/js/19.6f1127e8.js"><link rel="prefetch" href="/assets/js/20.aec2bca0.js"><link rel="prefetch" href="/assets/js/21.4d3c1b9b.js"><link rel="prefetch" href="/assets/js/22.509438de.js"><link rel="prefetch" href="/assets/js/23.5018fb14.js"><link rel="prefetch" href="/assets/js/24.201f4969.js"><link rel="prefetch" href="/assets/js/25.3dd15286.js"><link rel="prefetch" href="/assets/js/26.1074bdc3.js"><link rel="prefetch" href="/assets/js/3.60c22acf.js"><link rel="prefetch" href="/assets/js/4.eca2b075.js"><link rel="prefetch" href="/assets/js/6.e9b0de4e.js"><link rel="prefetch" href="/assets/js/7.f90aec6d.js"><link rel="prefetch" href="/assets/js/8.19f78893.js"><link rel="prefetch" href="/assets/js/9.89a4b848.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1e8ff529.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wdh2019的学习空间</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/" class="nav-link">博客</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blogs/" class="nav-link">博客</a></div><div class="nav-item"><a href="/notes/" class="nav-link">笔记</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/notes/internet/" class="sidebar-link">互联网</a></li><li><a href="/pages/notes/browser/" class="sidebar-link">浏览器</a></li><li><a href="/pages/notes/html/" class="sidebar-link">html</a></li><li><a href="/pages/notes/css/" class="sidebar-link">css</a></li><li><a href="/pages/notes/javascript/" class="sidebar-link">javascript</a></li><li><a href="/pages/notes/git/" class="sidebar-link">git</a></li><li><a href="/pages/notes/vue/" aria-current="page" class="active sidebar-link">vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue生命周期" class="sidebar-link">vue生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue2生命周期" class="sidebar-link">vue2生命周期</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue3生命周期钩子" class="sidebar-link">vue3生命周期钩子</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-双向数据绑定" class="sidebar-link">vue 双向数据绑定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#mvvm" class="sidebar-link">MVVM</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue2-响应式" class="sidebar-link">Vue2 响应式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue3-响应式" class="sidebar-link">Vue3 响应式</a></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue父子组件通信" class="sidebar-link">vue父子组件通信</a></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue兄弟组件通信" class="sidebar-link">vue兄弟组件通信</a></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue路由管理" class="sidebar-link">vue路由管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#hash模式" class="sidebar-link">hash模式</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#history模式" class="sidebar-link">history模式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vuex状态管理" class="sidebar-link">vuex状态管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#state" class="sidebar-link">state</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#mutations" class="sidebar-link">mutations</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#getters" class="sidebar-link">getters</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#actions" class="sidebar-link">actions</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#modules" class="sidebar-link">modules</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue3-0和2-0的区别" class="sidebar-link">vue3.0和2.0的区别</a></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-全局api" class="sidebar-link">Vue 2 全局API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-extend" class="sidebar-link">Vue.extend</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-nexttick" class="sidebar-link">Vue.nextTick</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-set" class="sidebar-link">Vue.set</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-delete" class="sidebar-link">Vue.delete</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-directive" class="sidebar-link">Vue.directive</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-filter" class="sidebar-link">Vue.filter</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-component" class="sidebar-link">Vue.component</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-use" class="sidebar-link">Vue.use</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-mixin" class="sidebar-link">Vue.mixin</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-compile" class="sidebar-link">Vue.compile</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-observable" class="sidebar-link">Vue.observable</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#vue-version属性" class="sidebar-link">Vue.version属性</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-选项与数据" class="sidebar-link">Vue 2 选项与数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#data" class="sidebar-link">data</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#props" class="sidebar-link">props</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#computed-计算属性" class="sidebar-link">computed（计算属性）</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#methods" class="sidebar-link">methods</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#watch" class="sidebar-link">watch</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-指令" class="sidebar-link">Vue 2 指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-text" class="sidebar-link">v-text</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-html" class="sidebar-link">v-html</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-show" class="sidebar-link">v-show</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-if" class="sidebar-link">v-if</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-else" class="sidebar-link">v-else</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-else-if" class="sidebar-link">v-else-if</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-for" class="sidebar-link">v-for</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-on" class="sidebar-link">v-on</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-bind" class="sidebar-link">v-bind</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-model" class="sidebar-link">v-model</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-slot" class="sidebar-link">v-slot</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-pre" class="sidebar-link">v-pre</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-cloak" class="sidebar-link">v-cloak</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#v-once" class="sidebar-link">v-once</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-特殊属性" class="sidebar-link">Vue 2 特殊属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#is属性" class="sidebar-link">is属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#ref属性" class="sidebar-link">ref属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#key属性" class="sidebar-link">key属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#slot" class="sidebar-link">slot</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-内置组件" class="sidebar-link">Vue 2 内置组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#keep-alive属性" class="sidebar-link">keep-alive属性</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#transition" class="sidebar-link">transition</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#transition-group" class="sidebar-link">transition-group</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-2-重要用法" class="sidebar-link">Vue 2 重要用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#自定义指令" class="sidebar-link">自定义指令</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#过滤器" class="sidebar-link">过滤器</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue-3-选项" class="sidebar-link">Vue 3 选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#data-2" class="sidebar-link">data</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#props-2" class="sidebar-link">props</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#computed-计算属性-2" class="sidebar-link">computed（计算属性）</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#methods-2" class="sidebar-link">methods</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#watch-2" class="sidebar-link">watch</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#组件的emits选项" class="sidebar-link">组件的emits选项</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/notes/vue/#vue2-x源码" class="sidebar-link">VUE2.x源码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#数据驱动" class="sidebar-link">数据驱动</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#组件化" class="sidebar-link">组件化</a></li><li class="sidebar-sub-header level3"><a href="/pages/notes/vue/#响应式原理" class="sidebar-link">响应式原理</a></li></ul></li></ul></li><li><a href="/pages/notes/webpack/" class="sidebar-link">webpack</a></li><li><a href="/pages/notes/less/" class="sidebar-link">less</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试真题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=notes" title="分类" data-v-06225672>notes</a></li><li data-v-06225672><a href="/categories/?category=frontend" title="分类" data-v-06225672>frontend</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">vue<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h1> <h2 id="vue生命周期"><a href="#vue生命周期" class="header-anchor">#</a> vue生命周期</h2> <h3 id="vue2生命周期"><a href="#vue2生命周期" class="header-anchor">#</a> vue2生命周期</h3> <img src="/assets/img/vue2-lifecycle.6f2c97f0.png"> <table><thead><tr><th>API</th> <th>描述</th></tr></thead> <tbody><tr><td><code>beforeCreate</code></td> <td>此时数据data和事件方法methods还未绑定到app对象上</td></tr> <tr><td><code>created</code></td> <td>此时数据data和事件方法methods绑定到app对象上</td></tr> <tr><td><code>beforeMount</code></td> <td>渲染之前，根据数据生成的DOM对象是获取不到的</td></tr> <tr><td><code>mounted</code></td> <td>渲染之后，数据生成的DOM对象能获取到</td></tr> <tr><td><code>beforeUpdate</code></td> <td>数据更改，但内容为更改之前</td></tr> <tr><td><code>updated</code></td> <td>内容已更改完毕</td></tr> <tr><td><code>beforeDestroy</code></td> <td>应用销毁之前</td></tr> <tr><td><code>destroyed</code></td> <td>应用销毁之后</td></tr></tbody></table> <p><img src="/assets/img/vue3-lifecycle.d2f8a1b7.svg" alt=""></p> <h3 id="vue3生命周期钩子"><a href="#vue3生命周期钩子" class="header-anchor">#</a> <strong>vue3生命周期</strong>钩子</h3> <table><thead><tr><th>API</th> <th>描述</th></tr></thead> <tbody><tr><td><code>beforeCreate</code></td> <td>在实例初始化之后，数据观测和event/watch事件配置之前</td></tr> <tr><td><code>created</code></td> <td>在实例创建完成之后。数据观测，property和方法的运算，watch/event事件回调完成。挂载阶段未开始，<code>$el</code> property 尚不可用。</td></tr> <tr><td><code>beforeMount</code></td> <td>在挂载开始之前，<code>render</code>函数首次调用</td></tr> <tr><td><code>mounted</code></td> <td>实例被挂载后，这时<code>app.mount</code>被新创建的<code>vm.$el</code>替换。如果希望等到整个视图都渲染完毕，可以在<code>mounted</code>内部使用vm.$nextTick()</td></tr> <tr><td><code>beforeUpdate</code></td> <td>数据更新时，发生在虚拟DOM打补丁之前。适合在更新前访问现有的DOM，比如手动移除已添加的事件监听器。</td></tr> <tr><td><code>updated</code></td> <td>数据更改导致虚拟DOM重新渲染和打补丁之后。组件DOM已经更新，可以执行依赖于DOM的操作。<strong>不会</strong>保证所有子组件都一起被重绘。如果希望等到整个视图都重绘完毕，可以在<code>update</code>内部使用vm.$nextTick()</td></tr> <tr><td><code>beforeUnmount</code></td> <td>在卸载组件实例之前。在此阶段，实例仍然是正常的。</td></tr> <tr><td><code>unmounted</code></td> <td>卸载组件实例后。组件实例的所有指令都被解除绑定，所有事件侦听器都被移除，所有子组件实例被卸载。</td></tr> <tr><td><code>errorCaptured</code></td> <td>当捕获一个来自子孙组件的错误时。收到3个参数：错误对象、发生错误的组件实例和一个包含错误来源信息的字符串。返回<code>false</code>可以阻止错误继续向上传播。</td></tr> <tr><td><code>renderTracked</code></td> <td>跟踪虚拟DOM重新渲染时。接收<code>debugger event</code>作为参数，告诉你哪个操作跟踪了组件以及该操作的目标对象和键。</td></tr> <tr><td><code>renderTriggered</code></td> <td>当虚拟DOM重新渲染被触发时。接收<code>debugger event</code>作为参数，告诉你是什么操作触发了重新渲染，以及该操作的目标对象和键。</td></tr> <tr><td>activated</td> <td>被<code>keep-alive</code>缓存的组件激活时调用</td></tr> <tr><td>deactivated</td> <td>被<code>keep-alive</code>缓存的组件停用时调用。</td></tr></tbody></table> <h2 id="vue-双向数据绑定"><a href="#vue-双向数据绑定" class="header-anchor">#</a> vue 双向数据绑定</h2> <p><code>v-model</code>是 vue 中最常用的用于双向数据绑定的指令。</p> <p>双向数据绑定指的是视图和数据的双向绑定：视图的更新触发所需数据的改变，而数据的改变触发依赖它的视图的重新渲染。</p> <h3 id="mvvm"><a href="#mvvm" class="header-anchor">#</a> MVVM</h3> <p>在更抽象的层面上，可以用 MVVM 模型来描述双向数据绑定：</p> <p><img src="/assets/img/mvvm.09f61b18.jpeg" alt="mvvm"></p> <p>在 MVVM 模型中，视图（View）代表了 DOM 元素的集合；模型（Model）代表了 JS 对象的集合（这些 JS 对象也是我们数据的来源）；而 视图模型（ViewModel）在 Vue 框架中，代表了 Vue 框架的一些中间处理逻辑。</p> <ol><li><p>从视图到模型，是通过 DOM Listeners，通俗地说，是依靠 DOM 事件。</p> <p>在 DOM 元素上绑定事件处理函数。当用户操作 DOM 元素并改变视图（比如 改变了输入框的输入内容），会触发事件，JS 会调用事件处理函数。</p> <p>在事件处理函数中，可以根据用户的操作改变模型中所需的 JS 对象（数据）。</p></li> <li><p>从模型到视图，是通过 Data Bindings，大致上说，这条线就是 【响应式数据】 干的活了。</p> <p>DOM 元素将某些属性与模型中的某个 JS 对象（数据）进行绑定，由于这些数据都是 【响应式】的，因此当数据改变时，DOM元素的属性也会响应改变。</p> <p><strong>如此，DOM 元素是不是就【依赖】于某个数据了。可以有很多不同的 DOM 元素都依赖于同一个数据（或者其属性），因此数据要进行【依赖收集】(depend)。而当数据改变时，它要通知（notify）依赖它的所有依赖项进行重新渲染。</strong></p> <p>这就是响应式的大致思路了。</p></li></ol> <p>可以用Vue的其他指令实现一个简单的数据双向绑定例子，供参考：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input v<span class="token operator">-</span>bind<span class="token operator">:</span>value <span class="token operator">=</span> <span class="token string">&quot;value&quot;</span> @input<span class="token operator">=</span><span class="token string">&quot;changeValue&quot;</span><span class="token operator">&gt;</span>
  
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>input</code>事件和<code>changeValue</code>事件处理函数，作为视图到模型的桥梁</li> <li>通过<code>v-bind</code>将输入框的<code>value</code>属性和Vue实例的<code>value</code>数据绑定，作为模型到视图的桥梁。（注意，在Vue实例的data选项定义的数据都会被自动转换为【响应式】）</li></ul> <h3 id="vue2-响应式"><a href="#vue2-响应式" class="header-anchor">#</a> Vue2 响应式</h3> <p><a href="https://cn.vuejs.org/v2/guide/reactivity.html">官网链接</a></p> <p>vue2 响应式原理是通过 <strong>数据劫持</strong> 结合 <strong>发布订阅模式</strong>的方式来实现的。</p> <p>数据劫持的核心方法就是使用<code>Object.defineProperty</code>把数据的每个属性添加<code>getter/setter</code>。</p> <ul><li>DOM 元素将属性绑定数据时，必然会先获取一次数据的值作为属性的初始值——这样就会触发数据的<code>getter</code>。别忘了还要【收集依赖】。（”你的属性是依赖我的？好的，我记一下。待会我变了会通知你“）</li> <li>而在数据发生改变时，会触发其<code>setter</code>，并对每个依赖项进行通知。（对每个记过的人：”我变了，告诉你一下，你要重新渲染了“）</li></ul> <p>为什么说这是 <strong>发布订阅模式</strong> 呢？</p> <p>这些依赖项（DOM 元素）就像数据的订阅者，一旦数据改变，就会被通知，并进行重新渲染。</p> <p>但是怎么记录这些依赖项呢？其实是用以下的<code>Watcher</code>去记录DOM元素是如何渲染的（<strong>渲染函数</strong>），并不关心真正对应的是哪个DOM元素。因为可以根据渲染函数去重新构建这个DOM元素（Vue中使用虚拟DOM节点）。（怎么在拿到数据的新值以后，重新渲染相应的DOM元素）。</p> <p>以下的<code>Dep</code>更像是个中间人，记录一个数据的所有依赖项（订阅者）。数据变化时，首先被<code>Observer</code>通知”数据变化了“，然后通知记录过的每个依赖项”数据变化了“。（然后<code>Watcher</code>自己调用自己的渲染函数，决定怎么更新视图）</p> <p>以下的<code>Observer</code>则是一道数据的监视器和拦截器。在此进行数据劫持的相关操作，以便在<code>getter</code>触发时通知<code>Dep</code>进行【依赖收集】，在<code>setter</code>触发时通知<code>Dep</code>数据变化。</p> <p>总结来说，以 发布订阅模式 来说，数据是 subject，视图是 subscriber，有个<code>Dep</code>对象充当中间人。</p> <p><img src="/assets/img/vue2-reactive0.c341bfa6.png" alt=""></p> <h4 id="observer"><a href="#observer" class="header-anchor">#</a> Observer:</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归遍历所有子属性</span>
    <span class="token keyword">var</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span>  <span class="token comment">// 判断是否需要添加订阅者</span>
                dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在这里添加一个订阅者</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> val<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'属性'</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">'已经被监听了，现在值为：“'</span> <span class="token operator">+</span> newVal<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'”'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果数据变化，通知所有订阅者</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Dep</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">addSub</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">notify</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="watcher"><a href="#watcher" class="header-anchor">#</a> watcher:</h4> <p>生成时加入到dep数组里</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Watcher</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>exp <span class="token operator">=</span> exp<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将自己添加到订阅器的操作</span>
<span class="token punctuation">}</span>
 
<span class="token class-name">Watcher</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> oldVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// 缓存自己</span>
        <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>exp<span class="token punctuation">]</span>  <span class="token comment">// 强制执行监听器里的get函数</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// 释放自己</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="observer和watcher连接起来"><a href="#observer和watcher连接起来" class="header-anchor">#</a> observer和watcher连接起来</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">SelfVue</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> el<span class="token punctuation">,</span> exp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化模板数据的值</span>
    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> exp<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue3-响应式"><a href="#vue3-响应式" class="header-anchor">#</a> Vue3 响应式</h2> <p><a href="https://v3.cn.vuejs.org/guide/reactivity.html">官方链接</a></p> <p>Vue3 的响应式原理和 vue2 不同，使用了 ES6的<code>Proxy</code>对象代替<code>Object.defineProperty()</code>方法。</p> <p><code>Proxy</code>对象本质上也是对源数据的一层代理，可以拦截对源数据的任何交互。其中也可以设置<code>getter</code>和<code>setter</code>拦截器。</p> <p>只不过，<code>Proxy</code>对象是对整个源数据的代理，对源数据任何属性的交互都会被代理对象拦截到！这样就不用以前那样遍历源数据的所有属性并对每个属性调用<code>Object.defineProperty()</code>了！</p> <p>响应式的核心思想并没有变，详情参考官方链接。</p> <h2 id="vue父子组件通信"><a href="#vue父子组件通信" class="header-anchor">#</a> vue父子组件通信</h2> <h4 id="父向子-props"><a href="#父向子-props" class="header-anchor">#</a> <strong>父向子：props</strong></h4> <p>子组件在props中添加一个属性，比如 <code>myproducts</code>，用于接收数据。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
	myproducts<span class="token operator">:</span> Array<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在父组件中，比如要传的数据变量名为<code>products</code>。</p> <p>父组件引入的子组件上，用<code>v-bind:myproducts=&quot;products&quot;</code>，将父组件要传的变量和子组件的prop绑定。</p> <p>接下来，在子组件可以使用该prop接收到的数据进行操作。</p> <h4 id="子向父-emit事件"><a href="#子向父-emit事件" class="header-anchor">#</a> <strong>子向父：$emit</strong>事件</h4> <p>在子组件中，调用this.$emit(&lt;子方法名&gt;, 要传递的变量)，比如<code>this.$emit(&quot;childFunc&quot;, this.message);</code></p> <p>在父组件中，定义一个父方法，比如<code>parentFunc</code>。用于接收子组件传来的数据。</p> <p>在父组件引入的子组件上，用<code>v-bind:childFunc = &quot;parentFunc&quot;</code>将父方法与子方法绑定。</p> <p>接下来，当子组件调用this.$emit()时，数据传入到父方法的参数列表中。</p> <h2 id="vue兄弟组件通信"><a href="#vue兄弟组件通信" class="header-anchor">#</a> vue兄弟组件通信</h2> <p>通过vue全局事件。</p> <p>首先在main.js中定义一个全局事件对象并绑定在Vue原型的$bus属性上。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>发送方组件：发起一个全局事件 this.$bus.$emit(&lt;事件名&gt;, 数据)，比如<code>this.$bus.$emit(&quot;message&quot;, this.message);</code></p> <p>接收方组件：接收这个全局事件，事件名保持一致 <code>this.$bus.$on(&quot;message&quot;, function(message){ ... } )</code></p> <h2 id="vue路由管理"><a href="#vue路由管理" class="header-anchor">#</a> vue路由管理</h2> <p>Vue-router 实例，一个路由引入对应的一个组件。这里用了异步引入的方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	routes<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
			name<span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
			<span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/Login'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			path<span class="token operator">:</span> <span class="token string">'/register'</span><span class="token punctuation">,</span>
			name<span class="token operator">:</span> <span class="token string">'register'</span><span class="token punctuation">,</span>
			<span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/Login'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
			name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
			<span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/components/Home'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			meta<span class="token operator">:</span> <span class="token punctuation">{</span>
				requireAuth<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 添加该字段，表示进入这个路由是需要登录的</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>vue router 分为两个模式：hash 和 history</p> <h3 id="hash模式"><a href="#hash模式" class="header-anchor">#</a> hash模式</h3> <p>利用<code>window.location.hash</code>。url的hash值（url中会出现<code>#</code>，<code>#</code>表示网页的一个位置，其后面的字符，就是该位置的标识符）发生变化时，根据这个值渲染绑定这个路由的组件。被称为前端路由，</p> <ul><li><p>路由跳转并不会真的向服务器发送请求。因为<code>#</code>后面的值不会发送到服务器，所以hash值改变不会触发浏览器发送请求。</p> <p>比如说访问<code>http://www.mywebsite.com/#</code>。第一次会发送请求到服务器，请求的url为<code>http://www.mywebsite.com/</code>（这是不可避免的），通常后端在处理路由<code>/</code>会返回<code>index.html</code>。</p> <p>而在后续跳转到其他路由，只是修改<code>#</code>以后的值，因为如果发送请求，请求url依然是<code>http://www.mywebsite.com/</code>，所以并不会服务器发送请求。</p></li> <li><p>页面跳转是通过修改<code>window.location.href</code>的值。</p></li> <li><p>页面跳转事件是监听window的<code>onhashchange</code>事件，在事件处理函数中渲染路由对应的组件。</p></li></ul> <h3 id="history模式"><a href="#history模式" class="header-anchor">#</a> history模式</h3> <p>利用了HTML5中全新升级的 History API，处理浏览器的历史记录。</p> <ul><li>因为没再使用hash值，所以url没有了<code>#</code>。而相对应的，每次改变了路由是真实改变了请求的url，所以都会向服务器请求url。如果服务器没有对该url的处理，那就会报 404 咯。
<ul><li>当然，可以现在nginx上配置 try_file 属性，让 nginx 在处理url的时候，可以试一试转发到其他路由，比如默认的<code>/index.html</code>。从而让服务器处理url有个兜底<code>index.html</code></li></ul></li> <li>路由前进调用<code>history.pushState()</code>，路由后退调用<code>history.popState()</code>。</li> <li>页面跳转事件是监听window的<code>onpopstate</code>事件，在事件处理函数中渲染路由对应的组件。</li></ul> <p><code>pushState()</code>接收3个参数：stateObject、title 和 url。</p> <ul><li>改变的stateObject 通过 history.state 来访问。</li> <li><code>title</code> 用于跳转后的页面标签页的 title。</li> <li><code>url</code>是要跳转到的 url。</li></ul> <p><strong>优势</strong>：</p> <ol><li><p>history模式能修改到同域名下的url，而不是仅仅修改<code>#</code>后的hash值。可以跳转的url更多。比如可以从<code>http://www.mywebsite.com/list</code>跳转到<code>http://www.mywebsite.com/video</code>。（存疑，因为改变hash值其实也能满足跳转到router实例里规定的所有路由，你还想跳转到哪些url？）</p></li> <li><p><code>pushState()</code>设置的新URL可以与当前URL一模一样，这样也会把记录添加到栈中；而hash设置的新值必须与原来不一样才会触发动作将记录添加到栈中；</p></li> <li><p><code>pushState()</code>通过stateObject参数可以添加任意类型的数据到记录中；而hash只可添加短字符串；</p></li> <li><p><code>pushState()</code>可额外设置title属性供后续使用。</p></li></ol> <h2 id="vuex状态管理"><a href="#vuex状态管理" class="header-anchor">#</a> vuex状态管理</h2> <img src="/assets/img/vuex.983ea11f.png"> <p>页面中模版获取state数据渲染页面，用户通过action改变数据导致页面重新渲染。</p> <p><code>state</code>：存放全局状态</p> <p><code>mutations</code>：对state成员进行操作，其中的方法用this.$store.commit(&lt;方法名&gt;，数据)调用。</p> <p><code>getters</code>：加工state成员并向外界传递</p> <p><code>action</code>：异步操作</p> <p><code>modules</code>：模块化状态管理</p> <h3 id="state"><a href="#state" class="header-anchor">#</a> state</h3> <p>在mutations的方法中，为配合Vue的响应式数据，应该：</p> <p>Vue.set添加或设置某个成员的值</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
</code></pre></div><p>Vue.delete删除成员</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mutations"><a href="#mutations" class="header-anchor">#</a> mutations</h3> <p>包含了同步函数。</p> <p>index.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    state<span class="token operator">:</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span><span class="token string">'helloVueX'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mutations<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//es6语法，等同edit:funcion(){...}</span>
        <span class="token function">edit</span><span class="token punctuation">(</span><span class="token parameter">state，payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'jack'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre></div><p>在组件中，调用mutations中的方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'edit'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="getters"><a href="#getters" class="header-anchor">#</a> getters</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>getters<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">nameInfo</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;姓名:&quot;</span><span class="token operator">+</span>state<span class="token punctuation">.</span>name
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fullInfo</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>getters</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> getters<span class="token punctuation">.</span>nameInfo<span class="token operator">+</span><span class="token string">'年龄:'</span><span class="token operator">+</span>state<span class="token punctuation">.</span>age
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre></div><p>在组件中，调用getters中的方法得到加工state成员后的返回值：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>fullInfo
</code></pre></div><h3 id="actions"><a href="#actions" class="header-anchor">#</a> actions</h3> <p>包含了异步函数。</p> <p><code>Actions</code>中的方法有两个默认参数</p> <ul><li><code>context</code> 上下文(相当于箭头函数中的this)对象</li> <li><code>payload</code> 挂载参数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>actions<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">aEdit</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span>payload</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'edit'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在组件中，调用actions中的方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'aEdit'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>age<span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="modules"><a href="#modules" class="header-anchor">#</a> modules</h3> <p>将store分割成许多模块（module），每个模块拥有自己的state, mutations, actions, getter</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>modules<span class="token operator">:</span><span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        getters<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token operator">...</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在组件中，调用模块a的状态：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>a
</code></pre></div><h2 id="vue3-0和2-0的区别"><a href="#vue3-0和2-0的区别" class="header-anchor">#</a> vue3.0和2.0的区别</h2> <ol><li><h5 id="压缩包体积更小"><a href="#压缩包体积更小" class="header-anchor">#</a> 压缩包体积更小</h5> <p>当前最小化并被压缩的 Vue 运行时大小约为 20kB（2.6.10 版为 22.8kB）。Vue 3.0捆绑包的大小大约会减少一半，即只有10kB</p></li> <li><h5 id="object-defineproperty-proxy"><a href="#object-defineproperty-proxy" class="header-anchor">#</a> Object.defineProperty -&gt; Proxy</h5> <p>Vue2.0响应式原理</p> <ul><li>响应化过程需要遍历data，props等，消耗较大</li> <li>不支持Set/Map、class、数组等类型</li> <li>新加或删除属性无法监听</li> <li>数组响应化需要额外实现</li> <li>对应的修改语法有限制</li></ul> <p>Vue3.0响应式原理：使用ES6的Proxy来解决这些问题。</p> <ul><li>在目标对象之上架了一层代理，代理的是对象而不是对象的属性，颗粒度变大。</li></ul></li> <li><h5 id="virtual-dom-重构"><a href="#virtual-dom-重构" class="header-anchor">#</a> Virtual DOM 重构</h5> <p>vdom的本质是一个抽象层，用javascript描述界面渲染成什么样子。react用jsx，没办法检测出可以优化的动态代码，所以做时间分片，<u>vue中足够快的话可以不用时间分片</u>。</p> <p><strong>传统vdom的性能瓶颈：</strong></p> <ul><li>虽然 Vue 能够保证触发更新的组件最小化，但在单个组件内部依然需要遍历该组件的整个 vdom 树。</li> <li>传统 vdom 的性能跟模版大小正相关，跟动态节点的数量无关。在一些组件整个模版内只有少量动态节点的情况下，这些遍历都是性能的浪费。</li> <li>JSX 和手写的 render function 是完全动态的，过度的灵活性导致运行时可以用于优化的信息不足</li></ul> <p><strong>那为什么不直接抛弃vdom呢？</strong></p> <ul><li>高级场景下手写 render function 获得更强的表达力</li> <li>生成的代码更简洁</li> <li>兼容2.x</li></ul> <p><u>vue的特点是底层为Virtual DOM，上层包含有大量静态信息的模版</u>。为了兼容手写 render function，最大化利用模版静态信息，vue3.0采用了<u>动静结合</u>的解决方案，将vdom的操作颗粒度变小，每次触发更新不再以组件为单位进行遍历，主要更改如下</p> <ul><li>将模版基于动态节点指令切割为嵌套的区块</li> <li>每个区块内部的节点结构是固定的</li> <li>每个区块只需要以一个 Array 追踪自身包含的动态节点</li></ul> <p><strong>vue3.0将 vdom 更新性能由与模版整体大小相关提升为与动态内容的数量相关</strong></p></li> <li><h5 id="选用function-based-api"><a href="#选用function-based-api" class="header-anchor">#</a> 选用Function_based API</h5> <p><img src="/assets/img/vue3-FunctionAPI.5a02ca8c.jpg" alt=""></p> <p>1、vue3.0将组件的逻辑都写在了函数内部，setup()会取代vue2.x的data()函数，返回一个对象，暴露给模板，而且只在初始化的时候调用一次，因为值可以被跟踪。</p> <p>2、新的函数api：const count = value(0)</p> <p>3、计算属性返回的也是这个值的包装。</p> <p>4、onMounted生命周期函数直接注入。</p> <p><strong>Function-based API 对比Class-based API有以下优点</strong></p> <p>1，<strong><u>对typescript更加友好</u></strong>，typescript对函数的参数和返回值都非常好，写Function-based API既是javascript又是typescript，不需要任何的类型声明，typescript可以自己做类型推导。</p> <p>2，静态的import和export是treeshaking的前提，Function-based API中的方法都是从全局的vue中import进来的。</p> <p>3，函数内部的变量名和函数名都可以被压缩为单个字母，但是对象和类的属性和方法名默认不被压缩（为了防止引用出错）。</p> <p>4，更灵活的逻辑复用。</p> <p>目前如果我们要在组件之间共享一些代码，则有两个可用的选择：mixins 和作用域插槽（ scoped slots），但是它们都存在一些缺陷：</p> <p>1，mixins 的最大缺点在于我们对它实际上添加到组件中的行为一无所知。这不仅使代码变得难以理解，而且还可能导致名称与现有属性和函数发生冲突。</p> <p>2，通过使用作用域插槽，我们确切地知道可以通过 v-slot 属性访问了哪些属性，因此代码更容易理解。这种方法的缺点是我们只能在模板中访问它，并且只能在组件作用域内使用。</p> <p>高阶组件在vue中比较少，在react中引入是作为mixins的替代品，但是比mixins更糟糕，高阶组件可以将多个组件进行包装，子组件通过props接收数据，多个高阶组件一起使用，不知道数据来自哪个高阶组件，存在命名空间的冲突。而且高阶组件嵌套得越多，额外的组件实例就越多，造成性能损耗。</p></li></ol> <h2 id="vue-2-全局api"><a href="#vue-2-全局api" class="header-anchor">#</a> Vue 2 全局API</h2> <h3 id="vue-extend"><a href="#vue-extend" class="header-anchor">#</a> Vue.extend</h3> <p>创建一个“子类”。参数是一个包含组件选项的对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 创建构造器</span>
<span class="token keyword">var</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token string">'&lt;p&gt;{{firstName}} {{lastName}} aka {{alias}}&lt;/p&gt;'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      firstName<span class="token operator">:</span> <span class="token string">'Walter'</span><span class="token punctuation">,</span>
      lastName<span class="token operator">:</span> <span class="token string">'White'</span><span class="token punctuation">,</span>
      alias<span class="token operator">:</span> <span class="token string">'Heisenberg'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 Profile 实例，并挂载到一个元素上。</span>
<span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#mount-point'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue-nexttick"><a href="#vue-nexttick" class="header-anchor">#</a> Vue.nextTick</h3> <p><code>Vue.nextTick([callback, context])</code></p> <p>在下次DOM更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的DOM。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 修改数据</span>
vm<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span>
<span class="token comment">// DOM还没有更新</span>
Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//DOM 更新了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 作为一个Promise使用</span>
Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// DOM更新了</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue-set"><a href="#vue-set" class="header-anchor">#</a> Vue.set</h3> <p><code>Vue.set(target, propertyName/index, value)</code></p> <p>向响应式对象中添加一个property，并确保这个新property同样是响应式的，且触发视图更新。</p> <h3 id="vue-delete"><a href="#vue-delete" class="header-anchor">#</a> Vue.delete</h3> <p><code>Vue.delete(target,propertyName/index)</code></p> <p>删除对象的property。如果对象是响应式的，确保删除能触发更新视图。</p> <h3 id="vue-directive"><a href="#vue-directive" class="header-anchor">#</a> Vue.directive</h3> <p><code>Vue.directive(id, [definition])</code></p> <p>注册或获取<u>全局指令</u>。</p> <h3 id="vue-filter"><a href="#vue-filter" class="header-anchor">#</a> Vue.filter</h3> <p><code>Vue.filter(id, [definition])</code></p> <p>注册或获取全局过滤器。</p> <h3 id="vue-component"><a href="#vue-component" class="header-anchor">#</a> Vue.component</h3> <p><code>Vue.component(id, [definition])</code></p> <p>注册或获取<u>全局组件</u>。注册还会自动使用给定的<code>id</code>设置组件名称。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 注册组件，传入一个扩展过的构造器</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 注册组件，传入一个选项对象 (自动调用 Vue.extend)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 获取注册的组件 (始终返回构造器)</span>
<span class="token keyword">var</span> MyComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'my-component'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue-use"><a href="#vue-use" class="header-anchor">#</a> Vue.use</h3> <p><code>Vue.use(plugin)</code></p> <p>安装Vue.js插件。如果插件是一个对象，必须提供<code>install</code>方法。如果插件是一个函数，它会被作为install方法。install方法调用时，会将Vue作为参数传入。</p> <ul><li>需要在调用 new Vue() 之前被调用。</li></ul> <h3 id="vue-mixin"><a href="#vue-mixin" class="header-anchor">#</a> Vue.mixin</h3> <p><code>Vue.mixin(mixin)</code></p> <p>全局注册一个混入，影响注册之后所有创建的Vue实例。可以使用混入，向组件注入自定义行为。</p> <h3 id="vue-compile"><a href="#vue-compile" class="header-anchor">#</a> Vue.compile</h3> <p><code>Vue.compile(template)</code></p> <p>将一个模板字符串编译成 render 函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> res <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;span&gt;{{ msg }}&lt;/span&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    msg<span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token operator">:</span> res<span class="token punctuation">.</span>render<span class="token punctuation">,</span>
  staticRenderFns<span class="token operator">:</span> res<span class="token punctuation">.</span>staticRenderFns
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue-observable"><a href="#vue-observable" class="header-anchor">#</a> Vue.observable</h3> <p><code>Vue.observable(object)</code></p> <p>让一个对象可响应。<strong>Vue内部用它来处理<code>data</code>函数返回的对象。</strong></p> <p>返回的对象可以直接用于<u>渲染函数</u>和<u>计算属性</u>内，并且会在发生变更时触发响应的更新。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> state <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Demo <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      on<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> state<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vue-version属性"><a href="#vue-version属性" class="header-anchor">#</a> Vue.version属性</h3> <p>提供字符串形式的Vue安装版本号。</p> <h2 id="vue-2-选项与数据"><a href="#vue-2-选项与数据" class="header-anchor">#</a> Vue 2 选项与数据</h2> <h3 id="data"><a href="#data" class="header-anchor">#</a> data</h3> <p>Vue 实例的数据对象。</p> <p>Vue 会递归地把 data 的 property 转换为 getter/setter，从而让 data 的 property 能够响应数据变化。</p> <p>实例创建后，通过<code>vm.$data</code>访问原始数据对象。Vue 实例代理了 data 对象上所有 property，因此访问<code>vm.a</code>等价于访问<code>vm.$data.a</code>。</p> <h4 id="为什么data是函数"><a href="#为什么data是函数" class="header-anchor">#</a> 为什么data是函数</h4> <p>当一个<strong>组件</strong>被定义，<code>data</code> 必须声明为返回一个初始数据对象的函数。</p> <p>因为组件可能被用来创建<strong>多个实例</strong>。如果 <code>data</code> 仍然是一个纯粹的对象，则所有的实例将<strong>共享引用</strong>同一个数据对象！</p> <p>通过提供 <code>data</code> 函数，每次创建一个新实例后，我们能够调用 <code>data</code> 函数，从而返回初始数据的一个全新副本数据对象。</p> <h3 id="props"><a href="#props" class="header-anchor">#</a> props</h3> <p>用于从父组件接收数据或对象。</p> <p>接收的对象可以有如下选项：</p> <ul><li><code>type</code>：类型检查。可以是<code>String</code>、<code>Number</code>、<code>Boolean</code>、<code>Array</code>、<code>Object</code>、<code>Date</code>、<code>Function</code>、<code>Symbol</code>。</li> <li><code>default</code>：默认值。如果该 prop 没有被传入，则使用这个值。</li> <li><code>required</code>：是否是必填项。</li> <li><code>validator</code>：自定义验证函数。会将该 prop 的值作为唯一的参数代入。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 简单语法</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'props-demo-simple'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token string">'myMessage'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 对象语法 </span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'props-demo-advanced'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 检测类型</span>
    height<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token comment">// 检测类型 + 其他验证</span>
    age<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value <span class="token operator">&gt;=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="computed-计算属性"><a href="#computed-计算属性" class="header-anchor">#</a> computed（计算属性）</h3> <p>计算属性会被混入到组件实例中，所有的 gette r和 setter 的<code>this</code>上下文绑定为组件实例。</p> <p>如果使用箭头函数，则<code>this</code>不会指向组件实例，但实例会作为函数的第一个参数。</p> <ul><li>计算属性的结果会被<strong>缓存</strong>，只有当依赖的响应式 property 变化时才会重新计算。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 仅读取</span>
    <span class="token function">aDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 读取和设置</span>
    aPlus<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="methods"><a href="#methods" class="header-anchor">#</a> methods</h3> <p>methods 会被混入到组件实例中。可以通过 VM 实例来访问。方法中的<code>this</code>绑定为组件实例。</p> <ul><li>不应该使用箭头函数来定义 method 函数，因为箭头函数的<code>this</code>绑定了父级作用域的上下文，而非组件实例。如<code>this.a</code>将是undefined。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h3> <p>一个对象，键是要侦听的响应式  property ——包含 data 或 计算属性 中的property，值是对应的回调函数。</p> <p>组件实例会在实例化时调用<code>$watch</code>。</p> <ul><li>不应该使用箭头函数定义 watcher 函数。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>watch<span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, old: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldVal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 监听对象b的任何属性的改变，无论嵌套多深（深层监听）</span>
	b<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c changed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		deep<span class="token operator">:</span><span class="token boolean">true</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-2-指令"><a href="#vue-2-指令" class="header-anchor">#</a> Vue 2 指令</h2> <h3 id="v-text"><a href="#v-text" class="header-anchor">#</a> v-text</h3> <p>更新元素的<code>textContent</code>。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>更新部分的<code>textContent</code>，使用插值<code>{{}}</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-html"><a href="#v-html" class="header-anchor">#</a> v-html</h3> <p>更新元素的<code>innerHTML</code>。</p> <ul><li>容易受到 XSS攻击。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-show"><a href="#v-show" class="header-anchor">#</a> v-show</h3> <p>根据表达式的真假值，切换元素的CSS样式：<code>display</code>。条件变化时触发过渡效果。</p> <h3 id="v-if"><a href="#v-if" class="header-anchor">#</a> v-if</h3> <p>条件渲染元素。在切换时元素及它的数据绑定/组件<strong>被销毁并重建</strong>。条件变化时触发过渡效果。</p> <h3 id="v-else"><a href="#v-else" class="header-anchor">#</a> v-else</h3> <p>条件渲染。限制：前一兄弟元素必须有<code>v-if</code>或<code>v-else-if</code>。</p> <h3 id="v-else-if"><a href="#v-else-if" class="header-anchor">#</a> v-else-if</h3> <p>条件渲染。限制：前一兄弟元素必须有<code>v-if</code>或<code>v-else-if</code>。</p> <h3 id="v-for"><a href="#v-for" class="header-anchor">#</a> v-for</h3> <p>基于源数据多次渲染元素或模板。</p> <ul><li>值使用特定语法：<code>alias in expression</code>，为当前遍历的元素提供别名。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in items<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  {{ item.text }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>默认尝试原地修改元素。使用<code>key</code>属性强制重新排序元素：</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	{{ item.text }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-on"><a href="#v-on" class="header-anchor">#</a> v-on</h3> <p>绑定事件监听器。缩写为<code>@</code>。</p> <p>用在普通元素上时，只能监听<strong>原生DOM事件</strong>。用在自定义元素组件上时，也可以监听子组件触发的<strong>自定义事件</strong>。</p> <p>可以传入一个<code>$event</code>对象表示事件对象：<code>v-on:click=&quot;handle('ok',$event)&quot;</code>。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 方法处理器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doThis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 动态事件 (2.6.0+) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>[event]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doThis<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 内联语句 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doThat(<span class="token punctuation">'</span>hello<span class="token punctuation">'</span>, $event)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-bind"><a href="#v-bind" class="header-anchor">#</a> v-bind</h3> <p>动态绑定一或多个属性，或一个组件 prop 到表达式。缩写为<code>:</code>。</p> <ul><li>绑定DOM的attribute属性</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 绑定一个 attribute --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imageSrc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>可以绑定<code>class</code>或<code>style</code>属性。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- class 绑定 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ red: isRed }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[classA, classB]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[classA, { classB: isB, classC: isC }]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- style 绑定 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ fontSize: size + <span class="token punctuation">'</span>px<span class="token punctuation">'</span> }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[styleObjectA, styleObjectB]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>绑定prop</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- prop 绑定。“prop”必须在 my-component 中声明。--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span> <span class="token attr-name">:prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>someThing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>传递数据给子元素</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 通过 $props 将父组件的 props 一起传给子组件 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>child<span class="token operator">-</span>component v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$props&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">-</span>component<span class="token operator">&gt;</span>
</code></pre></div><h3 id="v-model"><a href="#v-model" class="header-anchor">#</a> v-model</h3> <p>在表单控件或组件上创建双向绑定。</p> <h3 id="v-slot"><a href="#v-slot" class="header-anchor">#</a> v-slot</h3> <p>提供具名插槽或需要接收prop的插槽。缩写为<code>#</code>。</p> <h3 id="v-pre"><a href="#v-pre" class="header-anchor">#</a> v-pre</h3> <p>跳过这个元素和它的子元素的编译过程。可以用来显示原始Mustache标签（插值）。跳过大量没有指令的节点会加快编译。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-pre</span><span class="token punctuation">&gt;</span></span>{{ this will not be compiled }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-cloak"><a href="#v-cloak" class="header-anchor">#</a> v-cloak</h3> <p>保持在元素上直到关联实例结束编译。和CSS规则如<code>[v-cloak] { display: none }</code>一起用时，可以隐藏未编译的Mustache标签（插值）直到实例准备完毕。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">[v-cloak]</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-cloak</span><span class="token punctuation">&gt;</span></span>
  {{ message }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="v-once"><a href="#v-once" class="header-anchor">#</a> v-once</h3> <p>只渲染元素和组件<strong>一次</strong>。用于优化性能。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 单个元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-once</span><span class="token punctuation">&gt;</span></span>This will never change: {{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue-2-特殊属性"><a href="#vue-2-特殊属性" class="header-anchor">#</a> Vue 2 特殊属性</h2> <h3 id="is属性"><a href="#is属性" class="header-anchor">#</a> is属性</h3> <p>用于 动态组件。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentView<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&lt;/component
</code></pre></div><p>特殊用法：如果想用Vue组件替换原生DOM对象，加上前缀<code>vue</code>：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vue:my-row-component<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="ref属性"><a href="#ref属性" class="header-anchor">#</a> ref属性</h3> <p>用于在DOM元素或组件上注册一个引用。随后可以在父组件的$refs上访问。</p> <ul><li>非响应式的</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child-component</span><span class="token punctuation">&gt;</span></span>
// 当动态绑定ref时，可以把ref定义为一个回调函数，显式传递元素或组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(el)=&gt;child=el<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>child-component</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="key属性"><a href="#key属性" class="header-anchor">#</a> key属性</h3> <p>在区分一组旧节点和新节点时，用于标识虚拟DOM中的VNode。如果有key，会基于key来重新排序元素。</p> <p>拥有同一个父元素的子元素们必须有各自唯一的key。重复的key会导致渲染错误。</p> <ul><li>最常见的用法是在<code>v-for</code>中</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="slot"><a href="#slot" class="header-anchor">#</a> slot</h3> <p>用于一个组件的占位符。</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// 在组件 comp-a 中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

// 在引入它的父组件中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>

// 相当于
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>插入到组件中的html内容会被填充到<code>slot</code>的位置。</p> <ul><li><code>slot</code>可以有一个名字属性，在父组件中使用<code>v-slot:${name}</code>来指定替换匹配名字的<code>slot</code>，不写名字默认为default。（<strong>具名插槽</strong>）</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// 在组件comp-a中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
//在父组件中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>header</span><span class="token punctuation">&gt;</span></span>
		Header content	//这部分填充到名为header的slot中
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    	Default slot content //这部分默认填充到默认slot中
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>footer</span><span class="token punctuation">&gt;</span></span>
		Footer content //这部分填充到名为footer的slot中
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>可以把子组件的值传给<code>slot</code>，在父组件中用<code>v-slot:${name}</code>的值来接收：</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// 在组件 comp-a 中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:users</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

// 在引入它的父组件中
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>users<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user in users<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue-2-内置组件"><a href="#vue-2-内置组件" class="header-anchor">#</a> Vue 2 内置组件</h2> <h3 id="keep-alive属性"><a href="#keep-alive属性" class="header-anchor">#</a> keep-alive属性</h3> <ul><li>include：只有匹配的组件会被缓存。</li> <li>exclude：所有组件除了匹配的组件会被缓存。</li> <li>max：缓存的组件的最大数量。</li></ul> <p>当包住一个动态组件时，<code>keep-alive</code>会缓存组件实例而不会销毁他们。</p> <p><code>keep-alive</code>是抽象组件，不会渲染成一个DOM元素。</p> <p>当被包在<code>keep-alive</code>中的组件切换时，它的<code>actviated</code>和<code>deactivated</code>生命周期钩子会被调用。（替代了<code>mounted</code>和<code>unmounted</code>）。</p> <ul><li>用于保存组件状态和避免重新渲染。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-a</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a &gt; 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-b</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-b</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>include</code>和<code>exclude</code>会先检查组件的<code>name</code>属性，如果不存在则检查它在父组件里的<code>key</code>。匿名组件不会被匹配到。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- comma-delimited string --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a,b<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- regex (use `v-bind`) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/a|b/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Array (use `v-bind`) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span> <span class="token attr-name">:include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[<span class="token punctuation">'</span>a<span class="token punctuation">'</span>, <span class="token punctuation">'</span>b<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p><code>max</code>会在缓存的数量达到以后，最未被访问的组件实例会被销毁，随后创建新的实例。</p></li> <li><p><strong>注意</strong>：<code>keep-alive</code>对函数组件不起作用，因为它们没有实例。</p></li></ul> <h3 id="transition"><a href="#transition" class="header-anchor">#</a> transition</h3> <p>作为<u>单个</u>元素/组件的过渡效果。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 简单元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ok<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>toggled content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 动态组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fade<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appear</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>view<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 事件钩子 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transition-demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">@after-enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transitionComplete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ok<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>toggled content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="transition-group"><a href="#transition-group" class="header-anchor">#</a> transition-group</h3> <p>作为多个元素/组件的过渡效果</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>slide<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ item.text }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue-2-重要用法"><a href="#vue-2-重要用法" class="header-anchor">#</a> Vue 2 重要用法</h2> <h3 id="自定义指令"><a href="#自定义指令" class="header-anchor">#</a> 自定义指令</h3> <ul><li>注册全局自定义指令</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'foucs'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
	<span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>注册局部指令，组件中<code>directives</code>选项</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>directives<span class="token operator">:</span> <span class="token punctuation">{</span>
	focus<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function-variable function">inserted</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用自定义指令 <code>v-xxx</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input v<span class="token operator">-</span>focus<span class="token operator">&gt;</span>
</code></pre></div><h4 id="钩子函数"><a href="#钩子函数" class="header-anchor">#</a> 钩子函数</h4> <ul><li>bind：只调用一次，指令第一次绑定到元素时调用。</li> <li>inserted：被绑定元素插入父节点时调用。（仅保证父节点存在，但不一定已被插入文档中）</li> <li>update：所在组件的VNode更新时调用，但是可能发生在其子VNode更新之前。</li> <li>componentUpdated：指令所在组件的VNode及其子Node全部更新后调用。</li> <li>unbind：只调用一次，指令与元素解绑时调用。</li></ul> <h3 id="过滤器"><a href="#过滤器" class="header-anchor">#</a> 过滤器</h3> <p>可以用于 双花括号插值 和 <code>v-bind</code>表达式。过滤器应该被添加在JS表达式尾部，由“管道”符号指示，如下例中，<code>capitalize</code>和<code>formatId</code>为过滤器：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在双花括号中 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> message <span class="token operator">|</span> capitalize <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 在 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">v-bind</span><span class="token template-punctuation string">`</span></span> 中 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span>bind<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;rawId | formatId&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><ul><li>定义全局自定义过滤器</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'capitalize'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span>
  value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>定义局部过滤器，组件的<code>filters</code>选项</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>filters<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">capitalize</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span>
    value <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-3-选项"><a href="#vue-3-选项" class="header-anchor">#</a> Vue 3 选项</h2> <h3 id="data-2"><a href="#data-2" class="header-anchor">#</a> data</h3> <ul><li><p>类型：<code>Function</code></p></li> <li><p>返回组件实例的 data 对象。Vue在创建新组件实例时会调用此函数，然后通过响应性系统把返回的对象包裹起来，并以<code>$data</code>的形式存储在组件实例中。</p></li></ul> <h4 id="为什么data是函数-2"><a href="#为什么data是函数-2" class="header-anchor">#</a> 为什么data是函数</h4> <ul><li><p>当一个<strong>组件</strong>被定义，<code>data</code> 必须声明为返回一个初始数据对象的函数。</p> <p>因为组件可能被用来创建<strong>多个实例</strong>。如果 <code>data</code> 仍然是一个纯粹的对象，则所有的实例将<strong>共享引用</strong>同一个数据对象！</p> <p>通过提供 <code>data</code> 函数，每次创建一个新实例后，我们能够调用 <code>data</code> 函数，从而返回初始数据的一个全新副本数据对象。</p></li></ul> <h3 id="props-2"><a href="#props-2" class="header-anchor">#</a> props</h3> <p>用于从父组件接收数据或对象。</p> <p>接收的对象可以有如下选项：</p> <ul><li><code>type</code>：类型检查。可以是<code>String</code>、<code>Number</code>、<code>Boolean</code>、<code>Array</code>、<code>Object</code>、<code>Date</code>、<code>Function</code>、<code>Symbol</code>。</li> <li><code>default</code>：默认值。如果该 prop 没有被传入，则使用这个值。</li> <li><code>required</code>：是否是必填项。</li> <li><code>validator</code>：自定义验证函数。会将该 prop 的值作为唯一的参数代入。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 简单语法</span>
props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token string">'myMessage'</span><span class="token punctuation">]</span>

<span class="token comment">// 对象语法 </span>
props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 类型检查</span>
    height<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token comment">// 类型检查 + 其他验证</span>
    age<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value <span class="token operator">&gt;=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="computed-计算属性-2"><a href="#computed-计算属性-2" class="header-anchor">#</a> computed（计算属性）</h3> <p>计算属性会被混入到组件实例中，所有的 gette r和 setter 的<code>this</code>上下文绑定为组件实例。</p> <p>如果使用箭头函数，则<code>this</code>不会指向组件实例，但实例会作为函数的第一个参数。</p> <ul><li>计算属性的结果会被<strong>缓存</strong>，只有当依赖的响应式 property 变化时才会重新计算。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 仅读取</span>
    <span class="token function">aDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 读取和设置</span>
    aPlus<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> v <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="methods-2"><a href="#methods-2" class="header-anchor">#</a> methods</h3> <p>methods 会被混入到组件实例中。可以通过 VM 实例来访问。方法中的<code>this</code>绑定为组件实例。</p> <ul><li>不应该使用箭头函数来定义 method 函数，因为箭头函数的<code>this</code>绑定了父级作用域的上下文，而非组件实例。如<code>this.a</code>将是undefined。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="watch-2"><a href="#watch-2" class="header-anchor">#</a> watch</h3> <p>一个对象，键是要侦听的响应式  property ——包含 data 或 计算属性 中的property，值是对应的回调函数。</p> <p>组件实例会在实例化时调用<code>$watch</code>。</p> <ul><li>不应该使用箭头函数定义 watcher 函数。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>watch<span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, old: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldVal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 监听对象b的任何属性的改变，无论嵌套多深（深层监听）</span>
	b<span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c changed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		deep<span class="token operator">:</span><span class="token boolean">true</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="组件的emits选项"><a href="#组件的emits选项" class="header-anchor">#</a> 组件的emits选项</h3> <p>可以是数组或对象，从组件触发自定义事件。</p> <p>如果是对象，每个property 的值可以是null 或验证函数。验证函数将接收传递给<code>$emit</code>调用的其他参数。如<code>this.$emit('foo',1)</code>被调用，<code>foo</code>的响应验证函数将接收参数<code>1</code>返回布尔值，表示事件参数是否有效。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>emits<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 没有验证函数</span>
    click<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>

    <span class="token comment">// 带有验证函数</span>
    <span class="token function-variable function">submit</span><span class="token operator">:</span> <span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>email <span class="token operator">&amp;&amp;</span> payload<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid submit event payload!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="vue2-x源码"><a href="#vue2-x源码" class="header-anchor">#</a> VUE2.x源码</h2> <h3 id="数据驱动"><a href="#数据驱动" class="header-anchor">#</a> 数据驱动</h3> <h3 id="组件化"><a href="#组件化" class="header-anchor">#</a> 组件化</h3> <h3 id="响应式原理"><a href="#响应式原理" class="header-anchor">#</a> 响应式原理</h3> <h4 id="响应式对象"><a href="#响应式对象" class="header-anchor">#</a> 响应式对象</h4> <h5 id="object-defineproperty"><a href="#object-defineproperty" class="header-anchor">#</a> Object.defineProperty</h5> <p><code>Object.defineProperty</code> 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性， 并返回这个对象，先来看一下它的语法：</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
</code></pre></div><p><code>obj</code> 是要在其上定义属性的对象；<code>prop</code> 是要定义或修改的属性的名称；<code>descriptor</code> 是将被定义或修改的属性描述符。</p> <p>比较核心的是 <code>descriptor</code>，它有很多可选键值，具体的可以去参阅它的<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这里我们最关心的是 <code>get</code> 和 <code>set</code>，<code>get</code> 是一个给属性提供的 getter 方法，当我们访问了该属性的时候会触发 getter 方法；<code>set</code> 是一个给属性提供的 setter 方法，当我们对该属性做修改的时候会触发 setter 方法。</p> <p>一旦对象拥有了 getter 和 setter，我们可以简单地把这个对象称为响应式对象。那么 Vue.js 把哪些对象变成了响应式对象了呢，接下来我们从源码层面分析。</p> <h5 id="initstate"><a href="#initstate" class="header-anchor">#</a> initState</h5> <p>在 Vue 的初始化阶段，<code>_init</code> 方法执行的时候，会执行 <code>initState(vm)</code> 方法，它的定义在 <code>src/core/instance/state.js</code> 中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>initState</code> 方法主要是对 <code>props</code>、<code>methods</code>、<code>data</code>、<code>computed</code> 和 <code>wathcer</code> 等属性做了初始化操作。这里我们重点分析 <code>props</code> 和 <code>data</code>，对于其它属性的初始化我们之后再详细分析。</p> <ul><li>initProps</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component<span class="token punctuation">,</span> propsOptions<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// cache prop keys so that future props updates can iterate using Array</span>
  <span class="token comment">// instead of dynamic object key enumeration.</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> isRoot <span class="token operator">=</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$parent
  <span class="token comment">// root instance props should be converted</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propsOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hyphenatedKey <span class="token operator">=</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedAttribute</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span> <span class="token operator">||</span>
          config<span class="token punctuation">.</span><span class="token function">isReservedAttr</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hyphenatedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is a reserved attribute and cannot be used as component prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Avoid mutating a prop directly since the value will be </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">overwritten whenever the parent component re-renders. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Instead, use a data or computed property based on the prop's </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            vm
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// static props are already proxied on the component's prototype</span>
    <span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
    <span class="token comment">// instantiation here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>props</code> 的初始化主要过程，就是遍历定义的 <code>props</code> 配置。遍历的过程主要做两件事情：一个是调用 <code>defineReactive</code> 方法把每个 <code>prop</code> 对应的值变成响应式，可以通过 <code>vm._props.xxx</code> 访问到定义 <code>props</code> 中对应的属性。对于 <code>defineReactive</code> 方法，我们稍后会介绍；另一个是通过 <code>proxy</code> 把 <code>vm._props.xxx</code> 的访问代理到 <code>vm.xxx</code> 上，我们稍后也会介绍。</p> <ul><li>initData</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">initData</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data
  data <span class="token operator">=</span> vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'function'</span>
    <span class="token operator">?</span> <span class="token function">getData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">'data functions should return an object:\n'</span> <span class="token operator">+</span>
      <span class="token string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// proxy data on instance</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props
  <span class="token keyword">const</span> methods <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>methods
  <span class="token keyword">let</span> i <span class="token operator">=</span> keys<span class="token punctuation">.</span>length
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>methods<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Method &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; has already been defined as a data property.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The data property &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is already declared as a prop. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Use prop default value instead.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isReserved</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_data</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// observe data</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>data</code> 的初始化主要过程也是做两件事，一个是对定义 <code>data</code> 函数返回对象的遍历，通过 <code>proxy</code> 把每一个值 <code>vm._data.xxx</code> 都代理到 <code>vm.xxx</code> 上；另一个是调用 <code>observe</code> 方法观测整个 <code>data</code> 的变化，把 <code>data</code> 也变成响应式，可以通过 <code>vm._data.xxx</code> 访问到定义 <code>data</code> 返回函数中对应的属性，<code>observe</code> 我们稍后会介绍。</p> <p>可以看到，无论是 <code>props</code> 或是 <code>data</code> 的初始化都是把它们变成响应式对象，这个过程我们接触到几个函数，接下来我们来详细分析它们。</p> <h5 id="proxy"><a href="#proxy" class="header-anchor">#</a> proxy</h5> <p>首先介绍一下代理，代理的作用是把 <code>props</code> 和 <code>data</code> 上的属性代理到 <code>vm</code> 实例上，这也就是为什么比如我们定义了如下 props，却可以通过 vm 实例访问到它。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> comP <span class="token operator">=</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    msg<span class="token operator">:</span> <span class="token string">'hello'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以在 <code>say</code> 函数中通过 <code>this.msg</code> 访问到我们定义在 <code>props</code> 中的 <code>msg</code>，这个过程发生在 <code>proxy</code> 阶段：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  get<span class="token operator">:</span> noop<span class="token punctuation">,</span>
  set<span class="token operator">:</span> noop
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> Object<span class="token punctuation">,</span> sourceKey<span class="token operator">:</span> string<span class="token punctuation">,</span> key<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>proxy</code> 方法的实现很简单，通过 <code>Object.defineProperty</code> 把 <code>target[sourceKey][key]</code> 的读写变成了对 <code>target[key]</code> 的读写。所以对于 <code>props</code> 而言，对 <code>vm._props.xxx</code> 的读写变成了 <code>vm.xxx</code> 的读写，而对于 <code>vm._props.xxx</code> 我们可以访问到定义在 <code>props</code> 中的属性，所以我们就可以通过 <code>vm.xxx</code> 访问到定义在 <code>props</code> 中的 <code>xxx</code> 属性了。同理，对于 <code>data</code> 而言，对 <code>vm._data.xxxx</code> 的读写变成了对 <code>vm.xxxx</code> 的读写，而对于 <code>vm._data.xxxx</code> 我们可以访问到定义在 <code>data</code> 函数返回对象中的属性，所以我们就可以通过 <code>vm.xxxx</code> 访问到定义在 <code>data</code> 函数返回对象中的 <code>xxxx</code> 属性了。</p> <h5 id="observe"><a href="#observe" class="header-anchor">#</a> <code>observe</code></h5> <p><code>observe</code> 的功能就是用来监测数据的变化，它的定义在 <code>src/core/observer/index.js</code> 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Attempt to create an observer instance for a value,
 * returns the new observer if successfully observed,
 * or the existing observer if the value already has one.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any<span class="token punctuation">,</span> asRootData<span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> ob<span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> value<span class="token punctuation">.</span>__ob__
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    shouldObserve <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span>value<span class="token punctuation">.</span>_isVue
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asRootData <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob<span class="token punctuation">.</span>vmCount<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ob
<span class="token punctuation">}</span>
</code></pre></div><p><code>observe</code> 方法的作用就是给非 VNode 的对象类型数据添加一个 <code>Observer</code>，如果已经添加过则直接返回，否则在满足一定条件下去实例化一个 <code>Observer</code> 对象实例。接下来我们来看一下 <code>Observer</code> 的作用。</p> <h5 id="observer-2"><a href="#observer-2" class="header-anchor">#</a> Observer</h5> <p><code>Observer</code> 是一个类，它的作用是给对象的属性添加 getter 和 setter，用于依赖收集和派发更新：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object's property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> any<span class="token punctuation">;</span>
  dep<span class="token operator">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that has this object as root $data</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> augment <span class="token operator">=</span> hasProto
        <span class="token operator">?</span> protoAugment
        <span class="token operator">:</span> copyAugment
      <span class="token function">augment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Walk through each property and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span> <span class="token punctuation">(</span><span class="token parameter">items<span class="token operator">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Observer</code> 的构造函数逻辑很简单，首先实例化 <code>Dep</code> 对象，这块稍后会介绍，接着通过执行 <code>def</code> 函数把自身实例添加到数据对象 <code>value</code> 的 <code>__ob__</code> 属性上，<code>def</code> 的定义在 <code>src/core/util/lang.js</code> 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Define a property.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">def</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> string<span class="token punctuation">,</span> val<span class="token operator">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> val<span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>def</code> 函数是一个非常简单的<code>Object.defineProperty</code> 的封装，这就是为什么我在开发中输出 <code>data</code> 上对象类型的数据，会发现该对象多了一个 <code>__ob__</code> 的属性。</p> <p>回到 <code>Observer</code> 的构造函数，接下来会对 <code>value</code> 做判断，对于数组会调用 <code>observeArray</code> 方法，否则对纯对象调用 <code>walk</code> 方法。可以看到 <code>observeArray</code> 是遍历数组再次调用 <code>observe</code> 方法，而 <code>walk</code> 方法是遍历对象的 key 调用 <code>defineReactive</code> 方法，那么我们来看一下这个方法是做什么的。</p> <h5 id="definereactive"><a href="#definereactive" class="header-anchor">#</a> defineReactive</h5> <p><code>defineReactive</code> 的功能就是定义一个响应式对象，给对象动态添加 getter 和 setter，它的定义在 <code>src/core/observer/index.js</code> 中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  <span class="token parameter">obj<span class="token operator">:</span> Object<span class="token punctuation">,</span>
  key<span class="token operator">:</span> string<span class="token punctuation">,</span>
  val<span class="token operator">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>defineReactive</code> 函数最开始初始化 <code>Dep</code> 对象的实例，接着拿到 <code>obj</code> 的属性描述符，然后对子对象递归调用 <code>observe</code> 方法，这样就保证了无论 <code>obj</code> 的结构多复杂，它的所有子属性也能变成响应式的对象，这样我们访问或修改 <code>obj</code> 中一个嵌套较深的属性，也能触发 getter 和 setter。最后利用 <code>Object.defineProperty</code> 去给 <code>obj</code> 的属性 <code>key</code> 添加 getter 和 setter。而关于 getter 和 setter 的具体实现，我们会在之后介绍。</p> <h5 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h5> <p>这一节我们介绍了响应式对象，核心就是利用 <code>Object.defineProperty</code> 给数据添加了 getter 和 setter，目的就是为了在我们访问数据以及写数据的时候能自动执行一些逻辑：getter 做的事情是依赖收集，setter 做的事情是派发更新，那么在接下来的章节我们会重点对这两个过程分析。</p> <h4 id="依赖收集"><a href="#依赖收集" class="header-anchor">#</a> 依赖收集</h4> <h4 id="派发更新"><a href="#派发更新" class="header-anchor">#</a> 派发更新</h4> <h4 id="nexttick"><a href="#nexttick" class="header-anchor">#</a> nextTick</h4> <h4 id="检测变化的注意事项"><a href="#检测变化的注意事项" class="header-anchor">#</a> 检测变化的注意事项</h4> <h4 id="计算属性-vs-侦听属性"><a href="#计算属性-vs-侦听属性" class="header-anchor">#</a> 计算属性 vs 侦听属性</h4> <h4 id="组件更新"><a href="#组件更新" class="header-anchor">#</a> 组件更新</h4> <h4 id="原理图"><a href="#原理图" class="header-anchor">#</a> 原理图</h4> <p><img src="/assets/img/reactive.c9e2ac37.png" alt=""></p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=vue" title="标签">#vue</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/notes/git/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">git</div></a> <a href="/pages/notes/webpack/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">webpack</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/notes/git/" class="prev">git</a></span> <span class="next"><a href="/pages/notes/webpack/">webpack</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/blogs/Vue-vs-React/"><div>
            Vue vs React
            <!----></div></a> <span class="date">07-01</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/blogs/Vue2响应式/"><div>
            Vue2响应式
            <!----></div></a> <span class="date">07-01</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/blogs/使用Fetch请求文件，并下载到本地/"><div>
            使用Fetch请求文件，并下载到本地
            <!----></div></a> <span class="date">07-01</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a80134b2.js" defer></script><script src="/assets/js/2.0ddda4ce.js" defer></script><script src="/assets/js/5.09ae4475.js" defer></script>
  </body>
</html>
